<div class="quiz-wrapper">
  <!-- Use shared navigation bar -->
  <app-student-navbar></app-student-navbar>

  <div class="quiz-container">
    <div class="header">
      <h2>üìù Quiz Generator</h2>
    </div>

  <!-- Quiz Setup Form -->
  <div *ngIf="!quiz && !loading" class="setup-form">
    <div class="form-group">
      <label for="subject">Select Subject from Your Schedule:</label>
      <select 
        id="subject" 
        [(ngModel)]="subject" 
        class="form-control"
        [disabled]="loadingSubjects">
        <option value="">-- Choose a subject --</option>
        <option *ngFor="let subj of availableSubjects" [value]="subj">
          {{ subj }}
        </option>
      </select>
      <small *ngIf="loadingSubjects" class="text-muted">Loading subjects...</small>
      <small *ngIf="!loadingSubjects && availableSubjects.length === 0" class="text-muted">
        No subjects found. Generate a schedule first.
      </small>
    </div>

    <div class="form-group">
      <label for="topic">Specific Topic (optional):</label>
      <input 
        type="text" 
        id="topic" 
        [(ngModel)]="topic" 
        placeholder="e.g., Algebra, Programming Basics (leave empty for general)"
        class="form-control">
    </div>

    <div class="form-group">
      <label for="numQuestions">Number of Questions:</label>
      <input 
        type="number" 
        id="numQuestions" 
        [(ngModel)]="numQuestions" 
        min="3" 
        max="10"
        class="form-control">
    </div>

    <button (click)="generateQuiz()" class="btn btn-primary" [disabled]="!subject">
      Generate AI Quiz
    </button>
    <p class="info-text">‚ú® Questions will be generated by AI based on your subject</p>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Generating quiz questions...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error-message">
    {{ error }}
  </div>

  <!-- Quiz Questions -->
  <div *ngIf="quiz && !submitted" class="quiz-content">
    <div class="quiz-header">
      <h3>{{ quiz.subject }} - {{ quiz.topic }}</h3>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progress"></div>
      </div>
      <p class="question-counter">Question {{ currentQuestionIndex + 1 }} of {{ quiz.questions.length }}</p>
    </div>

    <div class="question-card" *ngIf="currentQuestion">
      <h4>{{ currentQuestion.question }}</h4>

      <div class="options">
        <div 
          *ngFor="let option of ['A', 'B', 'C', 'D']" 
          class="option"
          [class.selected]="answers[currentQuestionIndex] === option"
          (click)="selectAnswer(currentQuestionIndex, option)">
          <input 
            type="radio" 
            [name]="'question-' + currentQuestionIndex" 
            [value]="option"
            [checked]="answers[currentQuestionIndex] === option">
          <span class="option-label">{{ option }})</span>
          <span class="option-text">{{ getOptionText(currentQuestion, option) }}</span>
        </div>
      </div>
    </div>

    <div class="navigation-buttons">
      <button 
        (click)="previousQuestion()" 
        [disabled]="currentQuestionIndex === 0"
        class="btn btn-secondary">
        Previous
      </button>

      <button 
        *ngIf="!isLastQuestion"
        (click)="nextQuestion()" 
        class="btn btn-secondary">
        Next
      </button>

      <button 
        *ngIf="isLastQuestion"
        (click)="submitQuiz()" 
        [disabled]="!allQuestionsAnswered"
        class="btn btn-success">
        Submit Quiz
      </button>
    </div>
  </div>

  <!-- Quiz Results -->
  <div *ngIf="submitted && score !== null" class="quiz-results">
    <h3>Quiz Completed!</h3>
    
    <div class="score-display">
      <div class="score-circle" [class.high-score]="score >= 70" [class.medium-score]="score >= 50 && score < 70" [class.low-score]="score < 50">
        <span class="score-value">{{ score | number:'1.0-0' }}%</span>
      </div>
      <p class="score-details">
        You answered {{ correctAnswers }} out of {{ totalQuestions }} questions correctly
      </p>
    </div>

    <!-- Detailed Answer Review -->
    <div class="answers-review">
      <h4>Review Your Answers</h4>
      <div *ngFor="let question of quiz?.questions; let i = index" class="review-question">
        <div class="review-header">
          <span class="question-number">Q{{ i + 1 }}</span>
          <span class="result-badge" [class.correct]="question.isCorrect" [class.incorrect]="!question.isCorrect">
            {{ question.isCorrect ? '‚úì Correct' : '‚úó Incorrect' }}
          </span>
        </div>
        <p class="review-question-text">{{ question.question }}</p>
        <div class="review-answers">
          <div class="review-option" 
               *ngFor="let option of ['A', 'B', 'C', 'D']"
               [class.correct-answer]="option === question.correctAnswer"
               [class.student-answer]="option === question.studentAnswer"
               [class.wrong-answer]="option === question.studentAnswer && !question.isCorrect">
            <strong>{{ option }})</strong> {{ getOptionText(question, option) }}
            <span *ngIf="option === question.correctAnswer" class="badge correct">‚úì Correct Answer</span>
            <span *ngIf="option === question.studentAnswer && option !== question.correctAnswer" class="badge wrong">Your Answer</span>
          </div>
        </div>
      </div>
    </div>

    <div class="result-actions">
      <button (click)="completeRevision()" class="btn btn-success">
        Mark Revision as Complete
      </button>
      <button (click)="resetQuiz()" class="btn btn-secondary">
        Take Another Quiz
      </button>
    </div>
  </div>
  </div>
</div>
